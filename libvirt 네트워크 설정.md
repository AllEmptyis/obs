## libvirt 네트워크 기본 구조
- 호스트 내부에서 가상 네트워크 환경을 생성하고, 가상머신을 가상 네트워크 환경에 연결
- libvirt  역할
	- 리눅스 커널이 제공하는 네트워크 기능을 libvirt 툴을 사용하여 구성할 수 있도록 함
	- 즉 아래의 기능은 리눅스 커널의 네트워크 기능
### 구성
- virbr0
	- libvirt가 자동으로 생성하는 L2브릿지 (NAT모드에서 사용)
	- 해당 브릿지를 통해 vm이 내부 통신
- dnsmasq
	- 리눅스 기반 DHCP+DNS 데몬 (virbr0에 제공)
		- libvirt가 vm에게 자동으로 ip할당 및 내부 dns 처리를 위해 백그라운드에서 해당 데몬 실행
- VM: 가상머신
### 네트워크 유형
- NAT (default)
	- 기본 네트워크 (virbr0)
	- 내부 사설 IP를 가지고 있으며, 외부와 통신하기 위해서는 Source NAT 수행
		- iptables의 POSTROUTING 체인에서 수행
	- vm은 외부로 통신 가능 / 외부에서 vm으로 접근 불가
- Bridge
	- L2스위치처럼 동작하는 가상 인터페이스(br0)에 여러 인터페이스 연결하는 방식
	- 해당 br0은 물리 nic과 연결되어 있음
		- 따라서 vm과 호스트가 동일 네트워크에 존재
	- 브리지를 직접 생성해야 함
- isolated
	- vm간 통신만 가능 / 외부 통신 불가
- macvtap
	- VM을  호스트 NIC에 직접 연결
	- 호스트와는 통신 불가
		- 리눅스에서는 같은 NIC으로 들어온 패킷을 다시 자기자신에게 보내지 않기 때문
#### 구성
- bridge
```
   [ VM1 ]    [ VM2 ]
      │          │
      ▼          ▼
   [ tap0 ]   [ tap1 ] ← VM의 NIC (libvirt가 자동 생성)
       └──┬────┬──┘
          ▼    ▼
        [ br0 ]  ← 소프트웨어 브리지
          │
        [ eno1 ] ← 물리 NIC
          │
      외부 네트워크
```