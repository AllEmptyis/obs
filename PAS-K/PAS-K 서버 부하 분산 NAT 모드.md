## 서버 부하 분산 NAT 모드
### SLB란?
- 클라이언트에서 PAS-K로 요청 시 VIP로 요청
- PAS-K는 전송할 리얼서버 선택 후 요청 패킷의 목적지 주소를 해당 RIP로 NAT
#### 일반적인 용어
- vport : 클라이언트쪽에서 접속하게 되는 포트
- rport: 실제 접속하게 되는 리얼 서버의 포트

### 지원하는 NAT 모드
하위 3개 모드는 SLB 서비스에서만 이용 가능
- Dest NAT
- Both NAT
- L2 DSR mode
	- L2에서는 mac만 바꿔서 전달하기 때문에 IP 헤더를 바꿀 필요 없음 (L3 구간은 필요, ip 터널 사용)
- [[IP Tunnel DSR|L3 DSR mode]] (DSCP 방식 / IP터널 방식)
- LAN to LAN

### Dest NAT
- 일반적인 NAT 방식, 목적지 ip를 NAT(vip)

### Both NAT
- 출발지, 목적지 ip 둘 다 NAT

### L2 DSR mode
- 클라이언트는 L4를 통해 부하 분산하지만, 서버는 클라이언트에게 직접 응답
#### 기본 구성
- 클라이언트의 목적지 mac을 실제 서버 mac으로 변경하여 리얼 서버로 전송
- 그러나 리얼서버의 ip가 맞지 않기 때문에 응답x, 아래와 같은 설정 필요
	- 가상 ip 주소를 리얼 서버에 추가
	- vip에 대하여 리얼서버가 응답하지 않도록 arp 요청 응답하지 않도록 설정
#### 주요 사용
- FTP, 스트리밍 서비스와 같이 클라이언트로 가는 트래픽이 많은 경우 사용
- 서버가 L4를 거치지 않고 직접 응답하기 때문에 L4 부하 감소

### L3 DSR - IP터널링
- L2 DSR은 L4와 리얼서버가 동일한 브로드캐스트 영역에 존재하여 pas-k가 불필요한 패킷 수신
- L3 DSR은 브로드캐스트 영역 분리 가능
#### 기본 구성
- L4가 real server에게 전송할 때 IP터널을 이용하여 전송
#### 지원하는 방식
- DSCP (ToS 값 사용)
- IP 터널링